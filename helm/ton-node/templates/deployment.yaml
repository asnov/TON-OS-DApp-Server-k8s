---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    io.kompose.service: node
  name: node
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: node
  template:
    metadata:
      labels:
        io.kompose.service: node
    spec:
      containers:
      - args:
        - normal
        env:
        - name: ADNL_PORT
          value: "30303"
        - name: CONFIGS_PATH
          value: /ton-node/configs
        - name: MEM_LIMIT
          value: 32G
        - name: NETWORK_TYPE
          value: net.ton.dev
#        - name: MSIG_ENABLE
#        - name: SDK_URL
#        - name: STAKE
        - name: STATSD_DOMAIN
          value: 'statsd:'
        - name: STATSD_PORT
          value: "9125"
        - name: VALIDATOR_NAME
          value: my_validator
        image: senegal/tonlabs-ton-node:latest
        name: rnode
        ports:
        - containerPort: 30303
          protocol: UDP
          hostPort: 30303
        securityContext:
          capabilities:
            add:
            - SYS_PTRACE
        resources:
          limits:
            cpu: "4"
            memory: 8Gi
          requests:
            cpu: "1"
            memory: 2Gi
        volumeMounts:
          - name: config-vol
            mountPath: /ton-node/configs/config.json
            subPath: config.json 
          - name: default-config-vol
            mountPath: /ton-node/configs/default_config.json
            subPath: default_config.json
          - name: log-cfg-vol
            mountPath: /ton-node/configs/log_cfg.yml
            subPath: log_cfg.yml
#          - name: ton-global-vol
#            mountPath: /ton-node/configs/ton-global.config.json
#            subPath: ton-global.config.json
      volumes:
      - name: config-vol
        configMap:
          name: config
      - name: default-config-vol
        configMap:
          name: default-config
      - name: log-cfg-vol
        configMap:
          name: log-cfg
      - name: ton-global-vol
        configMap:
          name: ton-global
#        volumeMounts:
#        - mountPath: /ton-node/configs/
#          name: node-claim0
#        - mountPath: /ton-node/logs/
#          name: node-claim1
#        - mountPath: /ton-node/node_db/
#          name: DB
#        - mountPath: /tmp/metrics/
#          name: node-claim3
#      volumes:
#      - name: node-claim0
#        persistentVolumeClaim:
#          claimName: node-claim0
#      - name: node-claim1
#        persistentVolumeClaim:
#          claimName: node-claim1
#      - name: DB
#        persistentVolumeClaim:
#          claimName: DB
#      - name: node-claim3
#        persistentVolumeClaim:
#          claimName: node-claim3
