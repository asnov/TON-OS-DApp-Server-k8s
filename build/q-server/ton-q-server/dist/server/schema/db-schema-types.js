"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.u8enum = u8enum;
exports.isBigInt = isBigInt;
exports.unresolvedType = unresolvedType;
exports.toEnumStyle = toEnumStyle;
exports.stringifyEnumValues = stringifyEnumValues;
exports.getDocMD = getDocMD;
exports.parseDbSchema = parseDbSchema;
exports.scalarTypes = exports.DbTypeCategory = exports.otherCurrencyCollection = exports.OtherCurrency = exports.grams = exports.unixSeconds = exports.u32WithFormatter = exports.u128 = exports.u64 = exports.u32 = exports.u16 = exports.u8 = exports.i32 = exports.i8 = exports.required = exports.withDoc = exports.join = void 0;

var _gen = require("./gen.js");

var _schema = require("./schema.js");

const {
  ref,
  arrayOf
} = _schema.Def;
const ToStringFormatter = {
  unixMillisecondsToString: 'unixMillisecondsToString',
  unixSecondsToString: 'unixSecondsToString'
};

const join = (refDef, on, refOn, preCondition) => {
  return { ...ref(refDef),
    _: {
      join: {
        on,
        refOn,
        preCondition: preCondition || ''
      }
    }
  };
};

exports.join = join;

const withDoc = (def, doc) => ({ ...def,
  ...(doc ? {
    _doc: doc
  } : {})
});

exports.withDoc = withDoc;

const required = def => def;

exports.required = required;

const uint = (size, doc) => withDoc({
  _int: {
    unsigned: true,
    size
  }
}, doc);

const int = (size, doc) => withDoc({
  _int: {
    unsigned: false,
    size
  }
}, doc);

const i8 = doc => int(8, doc);

exports.i8 = i8;

const i32 = doc => int(32, doc);

exports.i32 = i32;

const u8 = doc => uint(8, doc);

exports.u8 = u8;

const u16 = doc => uint(16, doc);

exports.u16 = u16;

const u32 = doc => uint(32, doc);

exports.u32 = u32;

const u64 = doc => uint(64, doc);

exports.u64 = u64;

const u128 = doc => uint(128, doc);

exports.u128 = u128;

const u256 = doc => uint(256, doc);

const u32WithFormatter = (formatter, doc) => withDoc({
  _int: {
    unsigned: true,
    size: 32
  },
  _: {
    formatter
  }
}, doc);

exports.u32WithFormatter = u32WithFormatter;

const unixSeconds = doc => u32WithFormatter(ToStringFormatter.unixSecondsToString, doc);

exports.unixSeconds = unixSeconds;
const grams = u128;
exports.grams = grams;

function u8enum(name, values) {
  return doc => {
    const valuesDoc = Object.entries(values).map(([name, value]) => {
      return `- ${value} â€“ ${name}`;
    }).join('\n');
    const effectiveDoc = `${doc ? `${doc}\n` : ''}${valuesDoc}`;
    return withDoc({
      _int: {
        unsigned: true,
        size: 8
      },
      _: {
        enum: {
          name,
          values
        }
      }
    }, effectiveDoc);
  };
}

const OtherCurrency = {
  currency: u32(),
  value: u256()
};
exports.OtherCurrency = OtherCurrency;

const otherCurrencyCollection = doc => arrayOf(ref({
  OtherCurrency
}), doc);

exports.otherCurrencyCollection = otherCurrencyCollection;
const DbTypeCategory = {
  unresolved: 'unresolved',
  scalar: 'scalar',
  union: 'union',
  struct: 'struct'
};
exports.DbTypeCategory = DbTypeCategory;

function scalarType(name) {
  return {
    name,
    category: DbTypeCategory.scalar,
    fields: [],
    doc: ''
  };
}

const scalarTypes = {
  int: scalarType('Int'),
  uint64: scalarType('String'),
  uint1024: scalarType('String'),
  float: scalarType('Float'),
  boolean: scalarType('Boolean'),
  string: scalarType('String')
};
exports.scalarTypes = scalarTypes;

function isBigInt(type) {
  return type === scalarTypes.uint1024 || type === scalarTypes.uint64;
}

function unresolvedType(name) {
  return {
    name,
    category: DbTypeCategory.unresolved,
    fields: [],
    doc: ''
  };
}

function toEnumStyle(s) {
  return `${s.substr(0, 1).toUpperCase()}${s.substr(1)}`;
}

function stringifyEnumValues(values) {
  const fields = Object.entries(values).map(([name, value]) => {
    return `${toEnumStyle(name)}: ${value}`;
  });
  return `{ ${fields.join(', ')} }`;
}

function getDocMD(schema) {
  const doc = schema.doc;

  if (!doc) {
    return '';
  }

  if (typeof doc === 'string') {
    return doc;
  }

  if (doc.md) {
    return doc.md;
  }

  return '';
}

function parseDbSchema(schemaDef) {
  const dbTypes = [];
  const enumTypes = new Map();

  function parseDbField(typeName, schemaField) {
    let schemaType = schemaField;
    const field = {
      name: schemaField.name,
      arrayDepth: 0,
      type: scalarTypes.string,
      doc: getDocMD(schemaField)
    };

    while (schemaType.array) {
      field.arrayDepth += 1;
      schemaType = schemaType.array;
    }

    const ex = schemaType._;
    const enumDef = ex && ex.enum || null;

    if (enumDef) {
      field.enumDef = enumDef;
      enumTypes.set(enumDef.name, enumDef);
    }

    const join = ex && ex.join;

    if (join) {
      field.join = join;
    }

    if (ex && ex.formatter) {
      field.formatter = ex.formatter;
    }

    if (schemaType.union || schemaType.struct) {
      field.type = unresolvedType((0, _gen.makeFieldTypeName)(typeName, schemaField.name));
    } else if (schemaType.ref) {
      field.type = unresolvedType(schemaType.ref.name);
    } else if (schemaType.bool) {
      field.type = scalarTypes.boolean;
    } else if (schemaType.int) {
      const unsigned = schemaType.int && schemaType.int.unsigned || false;
      const size = schemaType.int && schemaType.int.size || 32;

      if (unsigned) {
        if (size >= 128) {
          field.type = scalarTypes.uint1024;
        } else if (size >= 64) {
          field.type = scalarTypes.uint64;
        } else if (size >= 32) {
          field.type = scalarTypes.float;
        } else {
          field.type = scalarTypes.int;
        }
      } else {
        if (size > 32) {
          throw new Error(`Integer type with size ${size} bit does not supported`);
        } else {
          field.type = scalarTypes.int;
        }
      }
    } else if (schemaType.float) {
      field.type = scalarTypes.float;
    } else if (schemaType.string) {
      field.type = scalarTypes.string;
    } else {
      field.type = scalarTypes.string;
      console.log('Invalid field type: ', JSON.stringify(schemaType));
      process.exit(1);
    }

    return field;
  }

  function unwrapArrays(type) {
    if (type.array) {
      return unwrapArrays(type.array);
    }

    return type;
  }

  function parseDbType(name, schemaType) {
    const struct = schemaType.union || schemaType.struct;

    if (!struct) {
      console.log(`?? ${name}: ${JSON.stringify(schemaType).substr(0, 200)}`);
      return;
    }

    const type = {
      name,
      category: schemaType.union ? DbTypeCategory.union : DbTypeCategory.struct,
      fields: [],
      collection: schemaType._.collection,
      doc: getDocMD(schemaType)
    };

    if (type.collection) {
      type.fields.push({
        name: 'id',
        arrayDepth: 0,
        type: scalarTypes.string,
        doc: ''
      });
    }

    struct.forEach(field => {
      type.fields.push(parseDbField(name, field));
      const unwrapped = unwrapArrays(field);
      const ownType = unwrapped.struct || unwrapped.union ? unwrapped : null;

      if (ownType) {
        parseDbType((0, _gen.makeFieldTypeName)(name, field.name), ownType);
      }
    });
    dbTypes.push(type);
  }

  const schema = (0, _schema.parseTypeDef)(schemaDef);

  if (schema.class) {
    schema.class.types.forEach(type => {
      parseDbType(type.name, type);
    });
  }

  const unresolved = new Map();
  const resolving = new Set();
  const resolved = new Map();
  const orderedResolved = [];
  dbTypes.forEach(t => unresolved.set(t.name, t));

  const resolveType = type => {
    if (resolved.has(type.name)) {
      return;
    }

    if (resolving.has(type.name)) {
      console.log(`WARNING: Circular reference to type ${type.name}`);
      return;
    }

    resolving.add(type.name);
    type.fields.forEach(field => {
      if (field.type.category === DbTypeCategory.unresolved) {
        let type = resolved.get(field.type.name);

        if (!type) {
          type = unresolved.get(field.type.name);

          if (type) {
            resolveType(type);
          } else {
            console.log(`Referenced type not found: ${field.type.name}`);
            process.exit(1);
          }
        }

        if (type) {
          field.type = type;
        }
      }
    });
    resolving.delete(type.name);
    orderedResolved.push(type);
    unresolved.delete(type.name);
    resolved.set(type.name, type);
  };

  dbTypes.forEach(resolveType);
  return {
    types: orderedResolved,
    enumTypes
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9zY2hlbWEvZGItc2NoZW1hLXR5cGVzLmpzIl0sIm5hbWVzIjpbInJlZiIsImFycmF5T2YiLCJEZWYiLCJUb1N0cmluZ0Zvcm1hdHRlciIsInVuaXhNaWxsaXNlY29uZHNUb1N0cmluZyIsInVuaXhTZWNvbmRzVG9TdHJpbmciLCJqb2luIiwicmVmRGVmIiwib24iLCJyZWZPbiIsInByZUNvbmRpdGlvbiIsIl8iLCJ3aXRoRG9jIiwiZGVmIiwiZG9jIiwiX2RvYyIsInJlcXVpcmVkIiwidWludCIsInNpemUiLCJfaW50IiwidW5zaWduZWQiLCJpbnQiLCJpOCIsImkzMiIsInU4IiwidTE2IiwidTMyIiwidTY0IiwidTEyOCIsInUyNTYiLCJ1MzJXaXRoRm9ybWF0dGVyIiwiZm9ybWF0dGVyIiwidW5peFNlY29uZHMiLCJncmFtcyIsInU4ZW51bSIsIm5hbWUiLCJ2YWx1ZXMiLCJ2YWx1ZXNEb2MiLCJPYmplY3QiLCJlbnRyaWVzIiwibWFwIiwidmFsdWUiLCJlZmZlY3RpdmVEb2MiLCJlbnVtIiwiT3RoZXJDdXJyZW5jeSIsImN1cnJlbmN5Iiwib3RoZXJDdXJyZW5jeUNvbGxlY3Rpb24iLCJEYlR5cGVDYXRlZ29yeSIsInVucmVzb2x2ZWQiLCJzY2FsYXIiLCJ1bmlvbiIsInN0cnVjdCIsInNjYWxhclR5cGUiLCJjYXRlZ29yeSIsImZpZWxkcyIsInNjYWxhclR5cGVzIiwidWludDY0IiwidWludDEwMjQiLCJmbG9hdCIsImJvb2xlYW4iLCJzdHJpbmciLCJpc0JpZ0ludCIsInR5cGUiLCJ1bnJlc29sdmVkVHlwZSIsInRvRW51bVN0eWxlIiwicyIsInN1YnN0ciIsInRvVXBwZXJDYXNlIiwic3RyaW5naWZ5RW51bVZhbHVlcyIsImdldERvY01EIiwic2NoZW1hIiwibWQiLCJwYXJzZURiU2NoZW1hIiwic2NoZW1hRGVmIiwiZGJUeXBlcyIsImVudW1UeXBlcyIsIk1hcCIsInBhcnNlRGJGaWVsZCIsInR5cGVOYW1lIiwic2NoZW1hRmllbGQiLCJzY2hlbWFUeXBlIiwiZmllbGQiLCJhcnJheURlcHRoIiwiYXJyYXkiLCJleCIsImVudW1EZWYiLCJzZXQiLCJib29sIiwiRXJyb3IiLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2Nlc3MiLCJleGl0IiwidW53cmFwQXJyYXlzIiwicGFyc2VEYlR5cGUiLCJjb2xsZWN0aW9uIiwicHVzaCIsImZvckVhY2giLCJ1bndyYXBwZWQiLCJvd25UeXBlIiwiY2xhc3MiLCJ0eXBlcyIsInJlc29sdmluZyIsIlNldCIsInJlc29sdmVkIiwib3JkZXJlZFJlc29sdmVkIiwidCIsInJlc29sdmVUeXBlIiwiaGFzIiwiYWRkIiwiZ2V0IiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUNBOztBQUNBOztBQVNBLE1BQU07QUFBRUEsRUFBQUEsR0FBRjtBQUFPQyxFQUFBQTtBQUFQLElBQW1CQyxXQUF6QjtBQUVBLE1BQU1DLGlCQUFpQixHQUFHO0FBQ3RCQyxFQUFBQSx3QkFBd0IsRUFBRSwwQkFESjtBQUV0QkMsRUFBQUEsbUJBQW1CLEVBQUU7QUFGQyxDQUExQjs7QUFRTyxNQUFNQyxJQUFJLEdBQUcsQ0FDaEJDLE1BRGdCLEVBRWhCQyxFQUZnQixFQUdoQkMsS0FIZ0IsRUFJaEJDLFlBSmdCLEtBS047QUFDVixTQUFPLEVBQ0gsR0FBR1YsR0FBRyxDQUFDTyxNQUFELENBREg7QUFFSEksSUFBQUEsQ0FBQyxFQUFFO0FBQ0NMLE1BQUFBLElBQUksRUFBRTtBQUNGRSxRQUFBQSxFQURFO0FBRUZDLFFBQUFBLEtBRkU7QUFHRkMsUUFBQUEsWUFBWSxFQUFHQSxZQUFZLElBQUk7QUFIN0I7QUFEUDtBQUZBLEdBQVA7QUFVSCxDQWhCTTs7OztBQWtCQSxNQUFNRSxPQUFPLEdBQUcsQ0FBQ0MsR0FBRCxFQUFlQyxHQUFmLE1BQWlDLEVBQ3BELEdBQUdELEdBRGlEO0FBRXBELE1BQUlDLEdBQUcsR0FBRztBQUFFQyxJQUFBQSxJQUFJLEVBQUVEO0FBQVIs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QUNTLE1BQVYsQ0FBaUJuRCxJQUFJLENBQUMzQixJQUF0QjtBQUNBd0UsSUFBQUEsZUFBZSxDQUFDVCxJQUFoQixDQUFxQnBDLElBQXJCO0FBQ0FkLElBQUFBLFVBQVUsQ0FBQ2lFLE1BQVgsQ0FBa0JuRCxJQUFJLENBQUMzQixJQUF2QjtBQUNBdUUsSUFBQUEsUUFBUSxDQUFDcEIsR0FBVCxDQUFheEIsSUFBSSxDQUFDM0IsSUFBbEIsRUFBd0IyQixJQUF4QjtBQUNILEdBOUJEOztBQStCQVksRUFBQUEsT0FBTyxDQUFDeUIsT0FBUixDQUFnQlUsV0FBaEI7QUFDQSxTQUFPO0FBQ0hOLElBQUFBLEtBQUssRUFBRUksZUFESjtBQUVIaEMsSUFBQUE7QUFGRyxHQUFQO0FBSUgiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IHttYWtlRmllbGRUeXBlTmFtZX0gZnJvbSBcIi4vZ2VuLmpzXCI7XG5pbXBvcnQge0RlZiwgcGFyc2VUeXBlRGVmfSBmcm9tIFwiLi9zY2hlbWEuanNcIjtcbmltcG9ydCB0eXBlIHtcbiAgICBJbnRTaXplVHlwZSxcbiAgICBTY2hlbWFEb2MsXG4gICAgU2NoZW1hTWVtYmVyLFxuICAgIFNjaGVtYVR5cGUsXG4gICAgVHlwZURlZlxufSBmcm9tIFwiLi9zY2hlbWEuanNcIjtcblxuY29uc3QgeyByZWYsIGFycmF5T2YgfSA9IERlZjtcblxuY29uc3QgVG9TdHJpbmdGb3JtYXR0ZXIgPSB7XG4gICAgdW5peE1pbGxpc2Vjb25kc1RvU3RyaW5nOiAndW5peE1pbGxpc2Vjb25kc1RvU3RyaW5nJyxcbiAgICB1bml4U2Vjb25kc1RvU3RyaW5nOiAndW5peFNlY29uZHNUb1N0cmluZycsXG5cbn1cblxuZXhwb3J0IHR5cGUgVG9TdHJpbmdGb3JtYXR0ZXJUeXBlID0gJFZhbHVlczx0eXBlb2YgVG9TdHJpbmdGb3JtYXR0ZXI+O1xuXG5leHBvcnQgY29uc3Qgam9pbiA9IChcbiAgICByZWZEZWY6IChzdHJpbmcgfCB7IFtzdHJpbmddOiBUeXBlRGVmIH0pLFxuICAgIG9uOiBzdHJpbmcsXG4gICAgcmVmT246IHN0cmluZyxcbiAgICBwcmVDb25kaXRpb24/OiBzdHJpbmcsXG4pOiBUeXBlRGVmID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5yZWYocmVmRGVmKSxcbiAgICAgICAgXzoge1xuICAgICAgICAgICAgam9pbjoge1xuICAgICAgICAgICAgICAgIG9uLFxuICAgICAgICAgICAgICAgIHJlZk9uLFxuICAgICAgICAgICAgICAgIHByZUNvbmRpdGlvbjogKHByZUNvbmRpdGlvbiB8fCAnJyksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCB3aXRoRG9jID0gKGRlZjogVHlwZURlZiwgZG9jPzogc3RyaW5nKSA9PiAoe1xuICAgIC4uLmRlZixcbiAgICAuLi4oZG9jID8geyBfZG9jOiBkb2MgfSA6IHt9KSxcbn0pO1xuXG5leHBvcnQgY29uc3QgcmVxdWlyZWQgPSAoZGVmOiBUeXBlRGVmKSA9PiBkZWY7XG5cbmNvbnN0IHVpbnQgPSAoc2l6ZTogSW50U2l6ZVR5cGUsIGRvYz86IHN0cmluZykgPT4gd2l0aERvYyh7XG4gICAgX2ludDoge1xuICAgICAgICB1bnNpZ25lZDogdHJ1ZSxcbiAgICAgICAgc2l6ZSxcbiAgICB9LFxufSwgZG9jKTtcblxuY29uc3QgaW50ID0gKHNpemU6IEludFNpemVUeXBlLCBkb2M/OiBzdHJpbmcpID0+IHdpdGhEb2Moe1xuICAgIF9pbnQ6IHtcbiAgICAgICAgdW5zaWduZWQ6IGZhbHNlLFxuICAgICAgICBzaXplLFxuICAgIH0sXG59LCBkb2MpO1xuXG5leHBvcnQgY29uc3QgaTggPSAoZG9jPzogc3RyaW5nKSA9PiBpbnQoOCwgZG9jKTtcbmV4cG9ydCBjb25zdCBpMzIgPSAoZG9jPzogc3RyaW5nKSA9PiBpbnQoMzIsIGRvYyk7XG5leHBvcnQgY29uc3QgdTggPSAoZG9jPzogc3RyaW5nKSA9PiB1aW50KDgsIGRvYyk7XG5leHBvcnQgY29uc3QgdTE2ID0gKGRvYz86IHN0cmluZykgPT4gdWludCgxNiwgZG9jKTtcbmV4cG9ydCBjb25zdCB1MzIgPSAoZG9jPzogc3RyaW5nKSA9PiB1aW50KDMyLCBkb2MpO1xuZXhwb3J0IGNvbnN0IHU2NCA9IChkb2M/OiBzdHJpbmcpID0+IHVpbnQoNjQsIGRvYyk7XG5leHBvcnQgY29uc3QgdTEyOCA9IChkb2M/OiBzdHJpbmcpID0+IHVpbnQoMTI4LCBkb2MpO1xuY29uc3QgdTI1NiA9IChkb2M/OiBzdHJpbmcpID0+IHVpbnQoMjU2LCBkb2MpO1xuXG5leHBvcnQgY29uc3QgdTMyV2l0aEZvcm1hdHRlciA9IChmb3JtYXR0ZXI6IFRvU3RyaW5nRm9ybWF0dGVyVHlwZSwgZG9jPzogc3RyaW5nKSA9PiB3aXRoRG9jKHtcbiAgICBfaW50OiB7XG4gICAgICAgIHVuc2lnbmVkOiB0cnVlLFxuICAgICAgICBzaXplOiAzMixcbiAgICB9LFxuICAgIF86IHtcbiAgICAgICAgZm9ybWF0dGVyLFxuICAgIH0sXG59LCBkb2MpO1xuXG5leHBvcnQgY29uc3QgdW5peFNlY29uZHMgPSAoZG9jPzogc3RyaW5nKSA9PiB1MzJXaXRoRm9ybWF0dGVyKFRvU3RyaW5nRm9ybWF0dGVyLnVuaXhTZWNvbmRzVG9TdHJpbmcsIGRvYyk7XG5cbmV4cG9ydCBjb25zdCBncmFtcyA9IHUxMjg7XG5cbnR5cGUgSW50RW51bVZhbHVlcyA9IHtcbiAgICBbc3RyaW5nXTogbnVtYmVyXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdThlbnVtKG5hbWU6IHN0cmluZywgdmFsdWVzOiBJbnRFbnVtVmFsdWVzKSB7XG4gICAgcmV0dXJuIChkb2M/OiBzdHJpbmcpOiBUeXBlRGVmID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWVzRG9jID0gT2JqZWN0LmVudHJpZXModmFsdWVzKS5tYXAoKFtuYW1lLCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiBgLSAkeyh2YWx1ZTogYW55KX0g4oCTICR7bmFtZX1gO1xuICAgICAgICB9KS5qb2luKCdcXG4nKTtcbiAgICAgICAgY29uc3QgZWZmZWN0aXZlRG9jID0gYCR7ZG9jID8gYCR7ZG9jfVxcbmAgOiAnJ30ke3ZhbHVlc0RvY31gO1xuICAgICAgICByZXR1cm4gd2l0aERvYyh7XG4gICAgICAgICAgICBfaW50OiB7XG4gICAgICAgICAgICAgICAgdW5zaWduZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgc2l6ZTogOCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfOiB7XG4gICAgICAgICAgICAgICAgZW51bToge1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZXMsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sIGVmZmVjdGl2ZURvYyk7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgT3RoZXJDdXJyZW5jeTogVHlwZURlZiA9IHtcbiAgICBjdXJyZW5jeTogdTMyKCksXG4gICAgdmFsdWU6IHUyNTYoKSxcbn07XG5cbmV4cG9ydCBjb25zdCBvdGhlckN1cnJlbmN5Q29sbGVjdGlvbiA9IChkb2M/OiBzdHJpbmcpOiBUeXBlRGVmID0+IGFycmF5T2YocmVmKHsgT3RoZXJDdXJyZW5jeSB9KSwgZG9jKTtcbmV4cG9ydCBjb25zdCBEYlR5cGVDYXRlZ29yeSA9IHtcbiAgICB1bnJlc29sdmVkOiAndW5yZXNvbHZlZCcsXG4gICAgc2NhbGFyOiAnc2NhbGFyJyxcbiAgICB1bmlvbjogJ3VuaW9uJyxcbiAgICBzdHJ1Y3Q6ICdzdHJ1Y3QnLFxufTtcbnR5cGUgRGJKb2luID0ge1xuICAgIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgICBvbjogc3RyaW5nLFxuICAgIHJlZk9uOiBzdHJpbmcsXG4gICAgcHJlQ29uZGl0aW9uOiBzdHJpbmcsXG59XG5leHBvcnQgdHlwZSBEYlR5cGUgPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGZpZWxkczogRGJGaWVsZFtdLFxuICAgIGNhdGVnb3J5OiAndW5yZXNvbHZlZCcgfCAnc2NhbGFyJyB8ICd1bmlvbicgfCAnc3RydWN0JyxcbiAgICBjb2xsZWN0aW9uPzogc3RyaW5nLFxuICAgIGRvYzogc3RyaW5nLFxufVxuZXhwb3J0IHR5cGUgSW50RW51bURlZiA9IHtcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdmFsdWVzOiB7XG4gICAgICAgIFtzdHJpbmddOiBudW1iZXJcbiAgICB9LFxufVxuZXhwb3J0IHR5cGUgRGJGaWVsZCA9IHtcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdHlwZTogRGJUeXBlLFxuICAgIGFycmF5RGVwdGg6IG51bWJlcixcbiAgICBqb2luPzogRGJKb2luLFxuICAgIGVudW1EZWY/OiBJbnRFbnVtRGVmLFxuICAgIGZvcm1hdHRlcj86IFRvU3RyaW5nRm9ybWF0dGVyVHlwZSxcbiAgICBkb2M6IHN0cmluZyxcbn1cblxuZnVuY3Rpb24gc2NhbGFyVHlwZShuYW1lOiBzdHJpbmcpOiBEYlR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGNhdGVnb3J5OiBEYlR5cGVDYXRlZ29yeS5zY2FsYXIsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICAgIGRvYzogJycsXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3Qgc2NhbGFyVHlwZXMgPSB7XG4gICAgaW50OiBzY2FsYXJUeXBlKCdJbnQnKSxcbiAgICB1aW50NjQ6IHNjYWxhclR5cGUoJ1N0cmluZycpLFxuICAgIHVpbnQxMDI0OiBzY2FsYXJUeXBlKCdTdHJpbmcnKSxcbiAgICBmbG9hdDogc2NhbGFyVHlwZSgnRmxvYXQnKSxcbiAgICBib29sZWFuOiBzY2FsYXJUeXBlKCdCb29sZWFuJyksXG4gICAgc3RyaW5nOiBzY2FsYXJUeXBlKCdTdHJpbmcnKSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0JpZ0ludCh0eXBlOiBEYlR5cGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gc2NhbGFyVHlwZXMudWludDEwMjQgfHwgdHlwZSA9PT0gc2NhbGFyVHlwZXMudWludDY0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5yZXNvbHZlZFR5cGUobmFtZTogc3RyaW5nKTogRGJUeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBjYXRlZ29yeTogRGJUeXBlQ2F0ZWdvcnkudW5yZXNvbHZlZCxcbiAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgICAgZG9jOiAnJyxcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0VudW1TdHlsZShzOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHtzLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpfSR7cy5zdWJzdHIoMSl9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ2lmeUVudW1WYWx1ZXModmFsdWVzOiB7IFtzdHJpbmddOiBudW1iZXIgfSk6IHN0cmluZyB7XG4gICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmVudHJpZXModmFsdWVzKS5tYXAoKFtuYW1lLCB2YWx1ZV0pID0+IHtcbiAgICAgICAgcmV0dXJuIGAke3RvRW51bVN0eWxlKG5hbWUpfTogJHsodmFsdWU6IGFueSl9YDtcbiAgICB9KTtcbiAgICByZXR1cm4gYHsgJHtmaWVsZHMuam9pbignLCAnKX0gfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREb2NNRChzY2hlbWE6IFNjaGVtYURvYyk6IHN0cmluZyB7XG4gICAgY29uc3QgZG9jID0gc2NoZW1hLmRvYztcbiAgICBpZiAoIWRvYykge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZG9jID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gZG9jO1xuICAgIH1cbiAgICBpZiAoZG9jLm1kKSB7XG4gICAgICAgIHJldHVybiAoZG9jLm1kOiBhbnkpO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG59XG5cbmV4cG9ydCB0eXBlIERiU2NoZW1hID0ge1xuICAgIHR5cGVzOiBEYlR5cGVbXSxcbiAgICBlbnVtVHlwZXM6IE1hcDxzdHJpbmcsIEludEVudW1EZWY+LFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VEYlNjaGVtYShzY2hlbWFEZWY6IFR5cGVEZWYpOiBEYlNjaGVtYSB7XG4gICAgY29uc3QgZGJUeXBlczogRGJUeXBlW10gPSBbXTtcbiAgICBjb25zdCBlbnVtVHlwZXM6IE1hcDxzdHJpbmcsIEludEVudW1EZWY+ID0gbmV3IE1hcCgpO1xuXG4gICAgZnVuY3Rpb24gcGFyc2VEYkZpZWxkKFxuICAgICAgICB0eXBlTmFtZTogc3RyaW5nLFxuICAgICAgICBzY2hlbWFGaWVsZDogU2NoZW1hTWVtYmVyPFNjaGVtYVR5cGU+LFxuICAgICk6IERiRmllbGQge1xuICAgICAgICBsZXQgc2NoZW1hVHlwZSA9IHNjaGVtYUZpZWxkO1xuICAgICAgICBjb25zdCBmaWVsZDogRGJGaWVsZCA9IHtcbiAgICAgICAgICAgIG5hbWU6IHNjaGVtYUZpZWxkLm5hbWUsXG4gICAgICAgICAgICBhcnJheURlcHRoOiAwLFxuICAgICAgICAgICAgdHlwZTogc2NhbGFyVHlwZXMuc3RyaW5nLFxuICAgICAgICAgICAgZG9jOiBnZXREb2NNRChzY2hlbWFGaWVsZCksXG4gICAgICAgIH07XG4gICAgICAgIHdoaWxlIChzY2hlbWFUeXBlLmFycmF5KSB7XG4gICAgICAgICAgICBmaWVsZC5hcnJheURlcHRoICs9IDE7XG4gICAgICAgICAgICBzY2hlbWFUeXBlID0gc2NoZW1hVHlwZS5hcnJheTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBleCA9IChzY2hlbWFUeXBlOiBhbnkpLl87XG4gICAgICAgIGNvbnN0IGVudW1EZWY6ID9JbnRFbnVtRGVmID0gKGV4ICYmIGV4LmVudW0pIHx8IG51bGw7XG4gICAgICAgIGlmIChlbnVtRGVmKSB7XG4gICAgICAgICAgICBmaWVsZC5lbnVtRGVmID0gZW51bURlZjtcbiAgICAgICAgICAgIGVudW1UeXBlcy5zZXQoZW51bURlZi5uYW1lLCBlbnVtRGVmKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBqb2luID0gZXggJiYgZXguam9pbjtcbiAgICAgICAgaWYgKGpvaW4pIHtcbiAgICAgICAgICAgIGZpZWxkLmpvaW4gPSBqb2luO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleCAmJiBleC5mb3JtYXR0ZXIpIHtcbiAgICAgICAgICAgIGZpZWxkLmZvcm1hdHRlciA9IGV4LmZvcm1hdHRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NoZW1hVHlwZS51bmlvbiB8fCBzY2hlbWFUeXBlLnN0cnVjdCkge1xuICAgICAgICAgICAgZmllbGQudHlwZSA9IHVucmVzb2x2ZWRUeXBlKG1ha2VGaWVsZFR5cGVOYW1lKHR5cGVOYW1lLCBzY2hlbWFGaWVsZC5uYW1lKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2NoZW1hVHlwZS5yZWYpIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSB1bnJlc29sdmVkVHlwZShzY2hlbWFUeXBlLnJlZi5uYW1lKTtcbiAgICAgICAgfSBlbHNlIGlmIChzY2hlbWFUeXBlLmJvb2wpIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5ib29sZWFuO1xuICAgICAgICB9IGVsc2UgaWYgKHNjaGVtYVR5cGUuaW50KSB7XG4gICAgICAgICAgICBjb25zdCB1bnNpZ25lZDogYm9vbGVhbiA9IChzY2hlbWFUeXBlLmludCAmJiBzY2hlbWFUeXBlLmludC51bnNpZ25lZCkgfHwgZmFsc2U7XG4gICAgICAgICAgICBjb25zdCBzaXplOiBudW1iZXIgPSAoc2NoZW1hVHlwZS5pbnQgJiYgc2NoZW1hVHlwZS5pbnQuc2l6ZSkgfHwgMzI7XG4gICAgICAgICAgICBpZiAodW5zaWduZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+PSAxMjgpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZSA9IHNjYWxhclR5cGVzLnVpbnQxMDI0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA+PSA2NCkge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMudWludDY0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA+PSAzMikge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0gc2NhbGFyVHlwZXMuZmxvYXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQudHlwZSA9IHNjYWxhclR5cGVzLmludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChzaXplID4gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnRlZ2VyIHR5cGUgd2l0aCBzaXplICR7c2l6ZX0gYml0IGRvZXMgbm90IHN1cHBvcnRlZGApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHNjaGVtYVR5cGUuZmxvYXQpIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5mbG9hdDtcbiAgICAgICAgfSBlbHNlIGlmIChzY2hlbWFUeXBlLnN0cmluZykge1xuICAgICAgICAgICAgZmllbGQudHlwZSA9IHNjYWxhclR5cGVzLnN0cmluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpZWxkLnR5cGUgPSBzY2FsYXJUeXBlcy5zdHJpbmc7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSW52YWxpZCBmaWVsZCB0eXBlOiAnLCBKU09OLnN0cmluZ2lmeShzY2hlbWFUeXBlKSk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVud3JhcEFycmF5cyh0eXBlOiBTY2hlbWFUeXBlKTogU2NoZW1hVHlwZSB7XG4gICAgICAgIGlmICh0eXBlLmFycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gdW53cmFwQXJyYXlzKHR5cGUuYXJyYXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0eXBlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhcnNlRGJUeXBlKFxuICAgICAgICBuYW1lOiBzdHJpbmcsXG4gICAgICAgIHNjaGVtYVR5cGU6IFNjaGVtYVR5cGVcbiAgICApIHtcbiAgICAgICAgY29uc3Qgc3RydWN0ID0gc2NoZW1hVHlwZS51bmlvbiB8fCBzY2hlbWFUeXBlLnN0cnVjdDtcbiAgICAgICAgaWYgKCFzdHJ1Y3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyAke25hbWV9OiAke0pTT04uc3RyaW5naWZ5KHNjaGVtYVR5cGUpLnN1YnN0cigwLCAyMDApfWApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHR5cGU6IERiVHlwZSA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBjYXRlZ29yeTogc2NoZW1hVHlwZS51bmlvbiA/IERiVHlwZUNhdGVnb3J5LnVuaW9uIDogRGJUeXBlQ2F0ZWdvcnkuc3RydWN0LFxuICAgICAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgICAgICAgIGNvbGxlY3Rpb246IChzY2hlbWFUeXBlOiBhbnkpLl8uY29sbGVjdGlvbixcbiAgICAgICAgICAgIGRvYzogZ2V0RG9jTUQoc2NoZW1hVHlwZSksXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHR5cGUuY29sbGVjdGlvbikge1xuICAgICAgICAgICAgdHlwZS5maWVsZHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2lkJyxcbiAgICAgICAgICAgICAgICBhcnJheURlcHRoOiAwLFxuICAgICAgICAgICAgICAgIHR5cGU6IHNjYWxhclR5cGVzLnN0cmluZyxcbiAgICAgICAgICAgICAgICBkb2M6ICcnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RydWN0LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICB0eXBlLmZpZWxkcy5wdXNoKHBhcnNlRGJGaWVsZChuYW1lLCBmaWVsZCkpO1xuICAgICAgICAgICAgY29uc3QgdW53cmFwcGVkID0gdW53cmFwQXJyYXlzKGZpZWxkKTtcbiAgICAgICAgICAgIGNvbnN0IG93blR5cGUgPSAodW53cmFwcGVkLnN0cnVjdCB8fCB1bndyYXBwZWQudW5pb24pID8gdW53cmFwcGVkIDogbnVsbDtcbiAgICAgICAgICAgIGlmIChvd25UeXBlKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VEYlR5cGUobWFrZUZpZWxkVHlwZU5hbWUobmFtZSwgZmllbGQubmFtZSksIG93blR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZGJUeXBlcy5wdXNoKHR5cGUpO1xuICAgIH1cblxuICAgIGNvbnN0IHNjaGVtYSA9IHBhcnNlVHlwZURlZihzY2hlbWFEZWYpO1xuXG4gICAgaWYgKHNjaGVtYS5jbGFzcykge1xuICAgICAgICBzY2hlbWEuY2xhc3MudHlwZXMuZm9yRWFjaCgodHlwZTogU2NoZW1hTWVtYmVyPFNjaGVtYVR5cGU+KSA9PiB7XG4gICAgICAgICAgICBwYXJzZURiVHlwZSh0eXBlLm5hbWUsIHR5cGUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGNvbnN0IHVucmVzb2x2ZWQ6IE1hcDxzdHJpbmcsIERiVHlwZT4gPSBuZXcgTWFwPHN0cmluZywgRGJUeXBlPigpO1xuICAgIGNvbnN0IHJlc29sdmluZzogU2V0PHN0cmluZz4gPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICBjb25zdCByZXNvbHZlZDogTWFwPHN0cmluZywgRGJUeXBlPiA9IG5ldyBNYXA8c3RyaW5nLCBEYlR5cGU+KCk7XG4gICAgY29uc3Qgb3JkZXJlZFJlc29sdmVkOiBEYlR5cGVbXSA9IFtdO1xuICAgIGRiVHlwZXMuZm9yRWFjaCh0ID0+IHVucmVzb2x2ZWQuc2V0KHQubmFtZSwgdCkpO1xuICAgIGNvbnN0IHJlc29sdmVUeXBlID0gKHR5cGU6IERiVHlwZSkgPT4ge1xuICAgICAgICBpZiAocmVzb2x2ZWQuaGFzKHR5cGUubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzb2x2aW5nLmhhcyh0eXBlLm5hbWUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgV0FSTklORzogQ2lyY3VsYXIgcmVmZXJlbmNlIHRvIHR5cGUgJHt0eXBlLm5hbWV9YCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2aW5nLmFkZCh0eXBlLm5hbWUpO1xuICAgICAgICB0eXBlLmZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUuY2F0ZWdvcnkgPT09IERiVHlwZUNhdGVnb3J5LnVucmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IHJlc29sdmVkLmdldChmaWVsZC50eXBlLm5hbWUpO1xuICAgICAgICAgICAgICAgIGlmICghdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0eXBlID0gdW5yZXNvbHZlZC5nZXQoZmllbGQudHlwZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVUeXBlKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFJlZmVyZW5jZWQgdHlwZSBub3QgZm91bmQ6ICR7ZmllbGQudHlwZS5uYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlc29sdmluZy5kZWxldGUodHlwZS5uYW1lKTtcbiAgICAgICAgb3JkZXJlZFJlc29sdmVkLnB1c2godHlwZSk7XG4gICAgICAgIHVucmVzb2x2ZWQuZGVsZXRlKHR5cGUubmFtZSk7XG4gICAgICAgIHJlc29sdmVkLnNldCh0eXBlLm5hbWUsIHR5cGUpO1xuICAgIH07XG4gICAgZGJUeXBlcy5mb3JFYWNoKHJlc29sdmVUeXBlKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlczogb3JkZXJlZFJlc29sdmVkLFxuICAgICAgICBlbnVtVHlwZXMsXG4gICAgfVxufVxuIl19